<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pong Game</title>
  <style>
    body { margin: 0; overflow: hidden; background: #000; color: #fff; font-family: sans-serif; }
    #options { position: absolute; top: 10px; left: 50%; transform: translateX(-50%); display: flex; gap: 1rem; z-index: 10; }
    #options label { display: flex; align-items: center; gap: 0.25rem; font-size: 0.9rem; }
    #menuBtn { display: none; position: absolute; top: 10px; right: 10px; z-index: 10; font-size: 1.5rem; background: none; border: none; color: #fff; }
    #menu { display: none; position: absolute; top: 50px; right: 10px; background: rgba(0,0,0,0.8); padding: 1rem; border-radius: 8px; flex-direction: column; gap: 0.5rem; z-index: 10; }
    #menu label { display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; }
    @media(max-width: 600px) {
      #options { display: none; }
      #menuBtn { display: block; }
    }
    #startOverlay, #endOverlay {
      position: absolute; top: 0; left: 0; width:100%; height:100%;
      display:flex; align-items:center; justify-content:center;
      background: rgba(0,0,0,0.7); font-size:2rem; z-index:5; flex-direction: column; gap:1rem;
    }
  </style>
</head>
<body>
  <canvas id="game"></canvas>
  <div id="options">
    <label><input type="checkbox" id="unbeatable"> Unbeatable</label>
    <label><input type="checkbox" id="doublePaddle"> 2x Paddle</label>
    <label><input type="checkbox" id="noSpeed"> No Speed</label>
    <label><input type="checkbox" id="cpuMode"> CPU Mode</label>
  </div>
  <button id="menuBtn">☰</button>
  <div id="menu">
    <label><input type="checkbox" id="unbeatable_m"> Unbeatable</label>
    <label><input type="checkbox" id="doublePaddle_m"> 2x Paddle</label>
    <label><input type="checkbox" id="noSpeed_m"> No Speed</label>
    <label><input type="checkbox" id="cpuMode_m"> CPU Mode</label>
  </div>
  <div id="startOverlay">Press anything to play</div>
  <div id="endOverlay" style="display:none;"></div>
  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    let width, height;
    function resize() {
      width = canvas.width = window.innerWidth;
      height = canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    class Paddle {
      constructor(x) {
        this.x = x;
        this.width = 10;
        this.height = 100;
        this.y = (height - this.height) / 2;
        this.speed = 5;
        this.double = false;
        this.doubleTimer = 0;
      }
      update() {
        if (this.double && Date.now() > this.doubleTimer) {
          this.double = false;
          this.height /= 2;
        }
      }
      draw() {
        ctx.fillStyle = '#fff';
        ctx.fillRect(this.x, this.y, this.width, this.height);
      }
    }

    class Ball {
      constructor() {
        this.reset();
      }
      reset() {
        this.x = width/2;
        this.y = height/2;
        this.speed = 10;
        this.angle = (Math.random()*Math.PI/2 - Math.PI/4);
        this.vx = this.speed * Math.cos(this.angle) * (Math.random()<0.5?-1:1);
        this.vy = this.speed * Math.sin(this.angle);
      }
      update(p1, p2) {
        this.x += this.vx;
        this.y += this.vy;
        if (this.y < 0 || this.y > height) this.vy = -this.vy;
        let paddle = null;
        if (this.x < p1.x + p1.width && this.y > p1.y && this.y < p1.y + p1.height) paddle = p1;
        if (this.x > p2.x - p2.width && this.y > p2.y && this.y < p2.y + p2.height) paddle = p2;
        if (paddle) {
          lastHit = paddle;
          if (!options.noSpeed) {
            this.speed += 0.01;
          }
          const dir = this.x < width/2 ? 1 : -1;
          this.angle = Math.random()*Math.PI/4 - Math.PI/8;
          this.vx = this.speed * Math.cos(this.angle) * dir;
          this.vy = this.speed * Math.sin(this.angle);
          if (this.speed >= 2) sparks.push(new Spark(this.x, this.y));
        }
      }
      draw() {
        ctx.fillStyle = '#fff';
        ctx.beginPath();
        ctx.arc(this.x, this.y, 8, 0, Math.PI*2);
        ctx.fill();
      }
    }

    class Spark {
      constructor(x,y) {
        this.x=x; this.y=y;
        this.vx=(Math.random()-0.5)*4;
        this.vy=(Math.random()-0.5)*4;
        this.life=30;
      }
      update() { this.x+=this.vx; this.y+=this.vy; this.life--; }
      draw() { ctx.fillRect(this.x,this.y,2,2); }
    }

    class PowerUp {
      constructor() {
        this.types = ['speedUp','speedDown','doublePaddle'];
        this.type = this.types[Math.floor(Math.random()*this.types.length)];
        this.x = Math.random()*(width-40)+20;
        this.y = Math.random()*(height-40)+20;
        this.size = 20;
      }
      draw() {
        ctx.fillStyle = '#ff0'; ctx.font='16px sans-serif'; ctx.textAlign='center';
        let icon = '';
        if (this.type==='speedUp') icon='▲';
        if (this.type==='speedDown') icon='▼';
        if (this.type==='doublePaddle') icon='↻';
        ctx.fillText(icon,this.x,this.y+6);
      }
      apply() {
        if (this.type==='speedUp') ball.speed+=0.5;
        if (this.type==='speedDown') ball.speed=Math.max(0.5,ball.speed-0.5);
        if (this.type==='doublePaddle') {
          lastHit.double = true;
          lastHit.height*=2;
          lastHit.doubleTimer = Date.now()+30000;
        }
      }
    }

    let p1 = new Paddle(10), p2 = new Paddle(width-20);
    let ball = new Ball();
    let sparks = [];
    let powerUp = null;
    let lastSpawn = 0;
    let nextSpawn = Date.now() + (Math.random()*90000+30000);
    let lastHit = null;
    let score = {player:0,cpu:0};
    let playing = false;
    const options = {unbeatable:false,doublePaddle:false,noSpeed:false,cpuMode:false};

    function draw() {
      ctx.clearRect(0,0,width,height);
      p1.draw(); p2.draw(); ball.draw();
      sparks.forEach(s=>s.draw());
      if (powerUp) powerUp.draw();
      ctx.fillText(`${score.player} : ${score.cpu}`,width/2,30);
    }

    function update() {
      if (!playing) return;
      p1.update(); p2.update(); ball.update(p1,p2);
      sparks = sparks.filter(s=>{s.update(); return s.life>0;});
      if (Date.now()>nextSpawn) {
        powerUp = new PowerUp(); nextSpawn = Date.now()+120000;
      }
      if (powerUp && Math.hypot(ball.x-powerUp.x,ball.y-powerUp.y)<20) {
        powerUp.apply(); powerUp=null;
      }
      if (ball.x < 0) { score.cpu++; endGame('Computer'); }
      if (ball.x > width) { score.player++; endGame('Player'); }
      if (!options.cpuMode) controlPlayer();
      controlCPU();
    }

    function controlPlayer() {}
    let up=false,down=false;
    window.addEventListener('keydown',e=>{ if (playing){ if (e.key==='ArrowUp') up=true; if(e.key==='ArrowDown') down=true;} else startGame(); });
    window.addEventListener('keyup',e=>{ if(e.key==='ArrowUp') up=false; if(e.key==='ArrowDown') down=false; });
    canvas.addEventListener('touchmove',e=>{ if(options.cpuMode)return; const t=e.touches[0]; p1.y = t.clientY - p1.height/2; });

    function controlPlayer(){ if(up) p1.y-=p1.speed; if(down) p1.y+=p1.speed; p1.y=Math.max(0,Math.min(height-p1.height,p1.y)); }
    function controlCPU(){ if(options.cpuMode||options.unbeatable) { p2.y = ball.y - p2.height/2; } else { if(ball.y < p2.y+p2.height/2) p2.y -= p2.speed; else p2.y += p2.speed; } p2.y=Math.max(0,Math.min(height-p2.height,p2.y)); }

    function startGame(){ score={player:0,cpu:0}; ball.reset(); p1=new Paddle(10); p2=new Paddle(width-20); sparks=[]; powerUp=null; lastSpawn=Date.now(); nextSpawn=Date.now()+30000; playing=true; document.getElementById('startOverlay').style.display='none'; document.getElementById('endOverlay').style.display='none'; }
    function endGame(winner){ playing=false; document.getElementById('endOverlay').innerText=`${winner} has won!`; document.getElementById('endOverlay').style.display='flex'; }

    document.getElementById('menuBtn').onclick = ()=>{ const m=document.getElementById('menu'); m.style.display=(m.style.display==='flex'?'none':'flex'); };
    ['unbeatable','doublePaddle','noSpeed','cpuMode'].forEach(id=>{
      document.getElementById(id).onchange=e=>{ options[id]=e.target.checked; };
      document.getElementById(id+'_m').onchange=e=>{ options[id]=e.target.checked; document.getElementById(id).checked=e.target.checked; };
    });

    function loop(){ update(); draw(); requestAnimationFrame(loop); }
    loop();
  </script>
</body>
</html>
